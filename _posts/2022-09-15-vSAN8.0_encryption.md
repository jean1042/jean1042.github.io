---
date: 2022-09-15
title: "vSAN 8.0 Express Storage Architectureμ μ•”νΈν™” κ³Όμ •"
categories: 
  - VMware
tags:
  - vSAN
---

Author: @Ji Yoon Park <br>
Reference: [VMware Tech Blog](https://core.vmware.com/blog/cluster-level-encryption-vsan-express-storage-architecture)


### 1. __Overview__
#### __vSAN ESA Cluster Level Encryption__

λ°μ΄ν„° μ•”νΈν™”λ” λ³΄μ• κ·μ  μ”κµ¬μ‚¬ν•­μ„ λ§μ¶”λ” κ²ƒμ— μμ–΄μ„ λ°λ“μ‹ ν•„μ”ν• λ‹¨κ³„μΈλ°λ„ λ¶κµ¬ν•κ³  λ•λ΅λ” λ³µμ΅μ„±μ΄λ‚ μ—„μ²­λ‚ λΉ„μ©, λ°μ΄ν„° μ•”νΈν™”λ΅ μΈν• μ„±λ¥ μν–¥μ„ κ³ λ ¤ν•΄μ•Ό ν•λ” λ•λ„ μμ.

μ΄λ² VMware Explore 2022μ—μ„ λ¦΄λ¦¬μ¦ λ VMware vSANβ„Ά 8μ„ ν†µν•΄μ„ μ•”νΈν™” μ»΄ν“¨ν… μ¤λ²„ν—¤λ“κ°€ μƒλ‹Ήν μ¤„μ–΄λ“¤μ—μΌλ©°, κ΄€λ¦¬ λ° μ μ§€λ³΄μλ” λ”μ± λ” μ‰¬μ›μ΅μ.

vSAN 8μ€ Express Storage Architecture (μ΄ν• ESA) λΌλ” ν•νƒλ΅ λ³€ν™”ν–μΌλ©°, ESAμ— λ€ν• μμ„Έν• λ‚΄μ©μ€ λ”°λ΅ μ •λ¦¬ν•κ³  μ΄λ²μ—λ” μ•”νΈν™” μ…μ¥μ—μ„λ§

### __2. vSAN 8.0 μ•”νΈν™” Architecture__

![1](https://user-images.githubusercontent.com/25656426/190297716-3a41c20b-ae3d-4df1-bed8-65f41df3be87.png)


- VMμ„ μ„ν• λ¦¬μ†μ¤ free upμ— λ“¤μ–΄κ°€λ” μ¤λ²„ν—¤λ“κ°€ ν¬κ² κ°μ†λ¨
- CPUμ™€ I/Oλ¥Ό μµμ†ν™”ν•κΈ° μ„ν•΄μ„ write μ‘μ—…μ΄ μΌμ–΄λ‚κΈ° μ΄μ „μ— μ•”νΈν™” μ‘μ—…μ΄ μν–‰λ¨
- CPU μ΄μ©λ¥  μµλ€ν™”μ™€ λ„¤νΈμ›ν¬ ν¨μ¨μ„± μ¦κ°€λ¥Ό μ„ν•΄μ„ cache diskμ— μ“°μ—¬μ§ λ• decryptν•κ³  / λ‹¤μ‹ μ¬ encrypt ν•λ μ‘μ—…μ΄ μ κ±°λ¨
- μ••μ¶• μ‘μ—…κ³Ό ν•¨κ» μΌμ–΄λ‚μ„ κ³µκ°„ ν¨μ¨ μΈ΅λ©΄μ΄ κ°μ„ λ¨
<br>


### __3. Original Storage Architecture(μ΄ν• OSA)μ™€μ λΉ„κµ__

![2](https://user-images.githubusercontent.com/25656426/190297723-64cd6481-bff4-450f-8890-bf15332b9586.png)


### __3-1. λ‹¬λΌμ§„ μ κ³Ό μ μ§€λλ” μ __

- OSAμ—μ„λ” vSAN Clusterμ λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•κΈ° μ„ν•΄ λ³„κ°μ encryption serviceλ¥Ό μ κ³µν–μ
- Encryptionμ— μμ–΄μ„, Cluster κΈ°μ¤€μ μ„λΉ„μ¤λΌλ” μ μ€ λ™μΌν•λ‚, vSANμ upper layerμ—μ„ incoming writeμ”μ²­μ„ λ°›μ„ λ• μ••μ¶•μ‘μ—…μ„ λ¨Όμ € ν•λ‹¤μμ— μ•”νΈν™”κ°€ μν–‰λλ‹¤λ” μ μ΄ μ°¨μ΄μ μ„
- μ•”νΈν™” λ‹¨κ³„λ” high stackμ—μ„ ν•λ²λ§ μ§„ν–‰λλ©°, high stackμ—μ„ λ°μƒν•κΈ° λ•λ¬Έμ— hostκ°„ μ „μ†΅λλ” vSAN trafficμ€ λ¨λ‘ μ•”νΈν™”λ μƒνƒλ΅ μ „μ†΅λμ–΄ λ³΄μ•μ μΈ μΈ΅λ©΄μ„ κ°μ„ ν•¨

---
π’΅ **3-2. SANμ upper layer(high stack)λ€?**
Two tierμ— Disk group (cache, data) μΌλ΅ κµ¬λ¶„λμ–΄μλ κΈ°μ΅΄ μ•„ν‚¤ν…μ²μ™€ λ‹¬λ¦¬, NVMe κΈ°λ°μ TLC ν”λμ‹ deviceλ΅ ν†µν•©λ Single-tierλ΅ κ°μ„ λμ—μ. 
New log-structured File System(LFS)λΌλ” μΈµμ΄ μ¤‘κ°„μ— λ„μ…λμ—κ³ , λΉ λ¥΄κ³  ν¨μ¨μ μΈ data processingμ„ ν•„μ”λ΅ ν•λ” μ‘μ—…μ€ LFSλ¥Ό κΈ°μ¤€μΌλ΅ topμ—μ„ μ²λ¦¬λλ„λ΅ ν–λ”λ°, LFS κΈ°μ¤€ topμ„ vSANμ upper layerλΌκ³  λ¶€λ¦„


π’΅ **3-3. LFSλ” λ­ν•λ” μΉκµ¬?**
Log Structured File System**
LFSλ” data μ“°κΈ° μ‘μ—…μ— μμ–΄μ„ νƒ„λ ¥μ μ΄κ³  κ³µκ°„ ν¨μ¨μ μΌλ΅ (κ·Έλ¬λ‚ μ΄μ  μ„±λ¥μ—λ” μν–¥λ„ λ°›μ§€ μ•κ³ ) write ν•λ” μ—­ν• μ„

---
### __4. Efficiency(ν¨μ¨) μΈ΅λ©΄μ—μ„μ κ°μ„ μ‚¬ν•­__

- ν¨μ¨μ μΈ μΈ΅λ©΄μ—μ„λ” μ•”νΈν™” ν•λ‚λ§ λ†“κ³  λ³Ό μλ” μ—†κ³ , compression(μ••μ¶•)κ³Ό μ§€μ • cache tier λ””λ°”μ΄μ¤μ— λ€ν• λ‹μ¦κ°€ μ—†μ–΄μ§€λ” μΈ΅λ©΄λ„ ν•¨κ» λ΄μ•Όν•¨.
- κΈ°μ΅΄ OSA κµ¬μ΅°λ³΄λ‹¤ I/O procesκ°€ κ·Ήμ μΌλ΅ κ°μ„ λμ—λ”λ°, μλ¥Ό λ“¤λ©΄
    - λ°μ΄ν„° blockμ€ 2:1λ΅ μ••μ¶•λμ—κ³ , κ·Έλ ‡κΈ° λ•λ¬Έμ— μ•”νΈν™” μ‘μ—…μ—μ„ CPU μ‚¬μ΄ν΄μ μ λ°λ§ μ‚¬μ©ν•¨
    - dataλ¥Ό μ½κ±°λ‚ μ¬λ™κΈ°ν™” μ‘μ—…μ„ ν•κΈ° μ„ν•΄ dataκ°€ μ „μ†΅λλ”λ°, κ·Έ μ „μ— μ••μ¶•μ„ ν‘Έλ” μ‘μ—…μ΄ μ—†μ–΄μ§
    - μ½κΈ° μ‘μ—…κ³Ό μ“°κΈ° μ‘μ—…μ— μμ–΄μ„ top stackμ—μ„ μΌμ–΄λ‚λ” μ••μ¶• μ‘μ—… λ•λ¬Έμ— network bandwidth μΈ΅λ©΄μ—μ„λ„ μ λ°λ§ μ‚¬μ©ν•¨
    - μ•”νΈν™” μ‘μ—…μ€ stackμ—μ„ ν•λ²λ§ λ°μƒν•κ³ , OSAμ™€ λΉ„κµν–μ„ λ• μ „μ²΄ λ³µνΈν™” / μ¬μ•”νΈν™”ν•λ κ³Όμ •μ΄ μ΄μ  μ‚¬λΌμ§!
        
        μ΄κ² λ¬΄μ¨ λ§μ΄λƒλ©΄, μ΄μ „μ—λ” dataλ¥Ό μ••μ¶• λ¨Όμ € λ‹¤μμ—, μΊμ‹ ν‹°μ–΄μ— write μ‘μ—…μ„ μ„ν•΄ μ•”νΈν™” ν•κΈ° μ „μ— μΊμ‹ μ¥μΉμ—μ„ dataλ¥Ό λ³µνΈν™”ν–μ–΄μ•Ό ν–μ
        

### __5. μ΄μ μΈ΅λ©΄μ—μ„μ vSAN μ•”νΈν™”__

- vSphere Native Key Provider μ„λΉ„μ¤κ°€ μλ”λ°, μ΄μ™€ μ—°λ™ν•λ©΄ vSAN encryption μ‹ μ‚¬μ©μλ” μ™Έλ¶€ ν‚¤λ§¤λ‹μ € μ„λΉ„μ¤ κ°™μ€ κ²ƒλ“¤μ„ μ‚¬μ©ν•  ν•„μ” μ—†μ΄ κΈ°μ΅΄μ²λΌ λ‡λ²μ ν΄λ¦­λ§μΌλ΅ μ•”νΈν™”λ¥Ό μ§„ν–‰ν•  μ μμ–΄ μ΄μμ μ…μ¥μ—μ„ λ„μ›€λ¨
- νΉμ •ν• κ·μ •μ„ μ¤€μν•΄μ•Όν•λ” μ”κµ¬μ‚¬ν•­μ΄ μλ” κ³ κ°μ κ²½μ°, κΈ°μ΅΄μ²λΌ λ°μ΄ν„° μ „μ†΅ κ³Όμ •μ—μ„ μ•”νΈν™”λ¥Ό ν•λ” μµμ…λ„ μ—¬μ „ν μ„ νƒν•  μ μμ. μ΄ κ²½μ°μ—λ„ vSAN 8 ESA clusterλ¥Ό μƒμ„±ν•  λ• encryption μµμ…μ΄ ν™μ„±ν™” λμ–΄μμ–΄μ•Όν•¨

End of docs